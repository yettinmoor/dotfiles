#!/bin/sh
# dwm statusbar script, somewhat inspired by i3blocks.
# Declare a function starting with "get_" to add a block.

sep="  |  "
rp="  " # right padding

get_music() {
	mpc -f "%artist% - %title%" | sed "/^volume/d" | tac |
		sed "
			s/\\[\(.*\)\\].*/\1 /;
			s/paused/⏸/;
			s/playing/▶/;" | tr -d '\n'
}

get_weather() {
	sed '13q;d' /tmp/weatherreport | \
		grep -o "m\\([+-]\\)*[0-9]\\+" | \
		sort -n -t 'm' -k 2n | \
		sed -n '1p;$p' | \
		tr '\n|m|+' ' ' | \
		awk '{print "" $2 "° " $1 "°"}'
}

get_packages() {
	pacman -Qu | grep -v "ignored" | wc -l | sed "/^0/d; s/^[0-9]/? &/"
}

get_rss() {
	[ -s /tmp/newsupdate ] && cat /tmp/newsupdate | tr -d '\n'
	newsboat -x print-unread | cut -d' ' -f1 | sed "/^0/d; s/^[0-9]/! &/"
}

get_volume() {
	printf "%s%%" $( pulsemixer --get-volume | cut -d' ' -f1 )
}

get_date() {
	printf "%s" "$( date '+%a %b/%d %R' )"
}

while true; do
	status=""
	for f in $( grep -o "^get_[a-z]*" $0 ); do
		val="$( $f )"
		status="$status$val${val:+$sep}"
	done
	xsetroot -name "${status%${sep}}$rp"
	sleep 10
done
