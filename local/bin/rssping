#!/usr/bin/env sh
# Set as a cron job to check for new RSS entries for newsboat.
# If newsboat is open, sends it an "R" key to refresh.

pgrep -x rssping >/dev/null && exit 1
ping -q -c 1 1.1.1.1 >/dev/null || exit 1

pgrep -x newsboat && xdotool search --name newsboat key R && exit

polybar-msg hook module/rss 2
newsboat -x reload

oldcount=$(cat ~/.config/newsboat/lastrun)
newcount=$(newsboat -x print-unread | grep -o '^[0-9]*' | tee .config/newsboat/lastrun)
[ $((newcount - oldcount)) -gt 0 ] && dunstify -u critical "$((newcount - oldcount)) new RSS item(s)"
# echo "$newcount" > ~/.config/newsboat/lastrun

polybar-msg hook module/rss 1
