#!/usr/bin/env sh

pick() {
    awk '{print $2}' "$SHORTCUT_DIR/directories" \
        | sed "s:^~:$HOME:" \
        | fzf --bind 'tab:replace-query+reload(echo {}; fd -t d . {} | sed s:/$::)'
}

[ -t 0 ] || pick() {
    tmp=$(mktemp -d)
    fifo="$tmp/dirpick.fifo"
    mkfifo "$fifo"

    $TERMINAL -c Dirpick -e sh -c "dirpick > $fifo" &

    cat "$fifo"
    rm -r "$tmp"
}

case "$1" in
    '') pick ;;
    mv)
        shift
        mv -v -t "$(pick)" "$@"
        ;;
    cp)
        shift
        cp -vr -t "$(pick)" "$@"
        ;;
esac
