#!/usr/bin/env sh
# Display fzf menu of
#   all git-tracked dotfiles,
#   all scripts in .local/bin,
#   all items in .config/shell,
# and open selected item in editor.

dir=$(mktemp -d)
fifo="$dir/se.fifo"
mkfifo "$fifo"

dot=~/repos/dotfiles

git -C $dot ls-tree -r --name-only HEAD >> "$fifo" &
fd . --base-directory $dot local/bin >> "$fifo" &
fd . --base-directory $dot config/shell >> "$fifo" &

sort "$fifo" \
    | uniq \
    | fzf --preview="bat -p --color always $dot/{}" \
    | xargs -r -I {} "$EDITOR" "$HOME/repos/dotfiles/{}"

rm -r "$dir"
