#!/usr/bin/env sh

wrap() { "$@"; }

while getopts s o; do
    case $o in
        s)
            if command -v devour > /dev/null 2>&1; then
                wrap() { devour "$@"; }
            fi
            ;;
        *) echo 'launch [-s] ...' ;;
    esac
done

shift $((OPTIND - 1))

[ $# -eq 0 ] && {
    echo 'launch [args]'
    exit 1
}

case "$(file --mime-type "$@" -bL)" in
    video/* | audio/*)
        wrap mpv "$@"
        ;;
    application/pdf | \
        application/postscript | \
        application/epub+zip | \
        application/x-rar | \
        image/vnd.djvu)
        wrap zathura "$@"
        ;;
    image/*)
        wrap sxiv "$@"
        ;;
    application/x-bittorrent)
        wrap tor "$@"
        ;;
    text/html)
        wrap "$BROWSER" "$@"
        ;;
    *)
        wrap "$TERMINAL" -e "$EDITOR $*"
        ;;
esac
