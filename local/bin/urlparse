#!/usr/bin/env sh

[ -z "$1" ] && exit 1

# If $1 is URL, just open it
echo "$1" | grep -E '^(https?://)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]+\.[a-zA-Z0-9]+.*$' && exit

dir=~/.config/urlparse

# If has search string, check searchengines
if [ $# -gt 1 ] \
    && [ -n "${se:=$(awk "!/^#/ && \$1 == \"$1\" {print \$2}" $dir/searchengines)}" ]; then
    shift
    # shellcheck disable=SC2059
    printf "$se" "$*"
    exit
fi

# Check bookmarks
if [ -n "${bm:=$(awk "!/#/ && \$1 == \"$1\" {print \$2}" $dir/bookmarks)}" ]; then
    echo "$bm"
    exit
fi

# Default to 1st search engine
# shellcheck disable=SC2059
printf "$(awk 'NR==1 {print $2}' $dir/searchengines)" "$*"
