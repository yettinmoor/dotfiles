#!/usr/bin/env sh

cd "$WIKI_DIR" || exit 1

case "$(basename "$0")" in
    lit)   FILE="booklog.md" ;;
    vidya) FILE="vidyalog.md" ;;
    *)
        echo 'invalid name, must be: [lit|vidya]'
        exit 1
        ;;
esac

if [ "$1" = '-e' ]; then
    $EDITOR "$FILE"
    exit
fi

if [ "$1" = '-x' ]; then
    shift
    exact=1
fi

[ -n "$1" ] && year="$1" || year="$(date +%Y)"

sed -e "0,/^\\# $year\$/d" -e "/$((year - 1))/q" "$FILE" \
    | rg '\*\*(.+)\*\*' -r '$1' \
    | if [ -n "$exact" ]; then rg '\[x\]'; else cat -; fi \
    | tr -d '_' \
    | tac
